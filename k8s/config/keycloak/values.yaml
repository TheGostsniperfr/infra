replicaCount: 1

global:
  defaultStorageClass: "longhorn"

image:
  registry: docker.io
  repository: bitnami/keycloak
  tag: "24.0.5-debian-12-r8"

production: true

containerPorts:
  http: 8080
  https: 8443
  metrics: 9000

service:
  type: ClusterIP
  ports:
    http: 8080
    https: 8443

extraVolumes:
  - name: realm-export-volume
    secret:
      secretName: keycloak-realm-secret

extraVolumeMounts:
  - name: realm-export-volume
    mountPath: /opt/bitnami/keycloak/data/import/

tls:
  enabled: true
  autoGenerated: true

ingress:
  enabled: true
  ingressClassName: "public"
  hostname: "auth.arffornia.com"
  path: "/"
  pathType: Prefix
  servicePort: "http"
  annotations:
    cert-manager.io/cluster-issuer: default-issuer
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      more_set_headers "X-Forwarded-Proto: https";
      more_set_headers "X-Forwarded-Scheme: https";

    nginx.ingress.kubernetes.io/proxy-buffer-size: "16k"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
    nginx.ingress.kubernetes.io/proxy-busy-buffers-size: "32k"
    nginx.ingress.kubernetes.io/large-client-header-buffers: "4 16k"
  tls: true
  extraTls:
    - hosts:
        - auth.arffornia.com
      secretName: keycloak-tls

postgresql:
  enabled: false

externalDatabase:
  host: "postgres-cluster.postgres.svc.cluster.local"
  port: 5432
  database: "keycloak"
  user: "keycloak"
  existingSecret: "keycloak-db-secret"
  existingSecretPasswordKey: "password"
  existingSecretUserKey: "username"

keycloakConfigCli:
  enabled: false

serviceAccount:
  create: true
  name: "keycloak-sa"

resources:
  requests:
    cpu: "100m"
    memory: "512Mi"
  limits:
    memory: "1Gi"

extraEnvVars:
  - name: KEYCLOAK_EXTRA_ARGS
    value: "--import-realm"
  - name: KEYCLOAK_ADMIN
    valueFrom:
      secretKeyRef:
        name: keycloak-admin-secret
        key: username
  - name: KEYCLOAK_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-admin-secret
        key: password
  - name: KC_HOSTNAME
    value: "auth.arffornia.com"
  - name: KC_PROXY
    value: "edge"
  - name: KC_HOSTNAME_STRICT_HTTPS
    value: "true"
  - name: KC_HTTP_ENABLED
    value: "true"
  - name: KC_HTTP_PORT
    value: "8080"
  - name: KC_DB
    value: "postgres"
  - name: KC_DB_URL_HOST
    value: "postgres-cluster.postgres.svc.cluster.local"
  - name: KC_DB_URL_PORT
    value: "5432"
  - name: KC_DB_URL_DATABASE
    value: "keycloak"
  - name: KC_DB_USERNAME
    valueFrom:
      secretKeyRef:
        name: keycloak-db-secret
        key: username
  - name: KC_DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-db-secret
        key: password
  - name: KC_DB_SCHEMA
    value: "public"
  - name: KC_LOG_LEVEL
    value: "INFO"
  - name: ROOT_LOGLEVEL
    value: "INFO"
